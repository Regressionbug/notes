[toc]

# 语法分析

## 上下文无关文法

使用上下文无关文法进行语法分析(终结符和非终结符的任意组合)

**概念**：句柄、直接短语、短语、分析树(p23、p25)

**文法变换**：

- 消除二义性：使用优先级
- 消除左递归：p29
- 提取左公因子：p31

## 自顶向下

### FIRST集和FOLLOW集

#### FIRST集

- 若$ X \in$ 终结符

$$
FIRST(X)=X
$$

- 若$X \in$ 非终结符

$$
若X\rightarrow Y_1Y_2且Y_1\rightarrow \epsilon
\\
则将FIRST(Y_2)加入到FIRST(X)中
\\
\
\\
若X\rightarrow \epsilon
\\
则将\epsilon加入到FIRST(X)中
$$

#### FOLLOW集

- 若S是开始符号($是右端结束标记)

$$
将\$ 放入FOLLOW(S)中
$$

- 若存在产生式$A \rightarrow \alpha B \beta $

$$
将FIRST(\beta)中除\epsilon之外的所有符号放入FOLLOW(B)中
$$

- 若存在产生式$A \rightarrow \alpha B$或存在产生式$A \rightarrow \alpha B \beta $且$\epsilon \in FIRST(\beta)$

$$
将FOLLOW(A)中所有符号放入FOLLOW(B)中
$$



### LL(1)文法

对于$A \rightarrow \alpha|\beta$任意两个产生式

- 不存在终结符号*a*使得$\alpha$和$\beta$都可以推导出以*a*开头的串

$$
FIRST(\alpha)\bigcap FIRST(\beta)=\epsilon
$$

- $\alpha$和$\beta$最多只有一个可以推导出空串
- 如果$\beta\Longrightarrow \epsilon$，则$\alpha$不能推导出任何以$FOLLOW(A)$中某个终结符号开头的串

$$
FOLLOW(A)\bigcap FOLLOW(\alpha)=\epsilon
$$



### 递归分析

由一组过程组成，每个非终结符号有一个对应的过程

- 可能需要回溯
- 无法处理左递归文法(进入无限循环)

具体实现：函数递归调用(p87)



### 非递归分析

非递归的预测分析器，由五部分组成：

- 输入缓冲区：存放被分析的输入符号串，串尾的符号$是符号串结束标志

- 输出流：分析过程中所采用的产生式序列

- 分析栈：存放一系列文法符号，符号$\$$标识栈底。开始分析时，先将$\$$压入栈，再将开始符号压入

- 预测分析程序：根据栈顶符号$X$和当前输入符号$a$来决定分析程序应采取的动作
  - 若$X=a=\$$，分析成功，停止分析
  - 若$X=a\neq \$ $ ，从栈顶弹出$X$，向前指针前移一个位置
  - 若$X$是终结符号，且$X\neq a$，发生错误
  - 若$X$是终结符号，则访问预测分析表$M[X,a]$
    - 若$M[X,a]$是产生式$X \rightarrow Y_1Y_2...Y_k$，则先将$X$弹出栈顶，然后将产生右部反序($Y_k...Y_2Y_1$)压入栈中
    - 若$M[X,a]$是产生式$X \rightarrow \epsilon$，则预测分析程序从栈顶弹出$X$
  
- 预测分析表

  如有当前输入符号$a$，产生式$A \rightarrow \beta$，当$A$位于分析栈栈顶时：

  - 如果当前输入符号$a \in FIRST(\beta)$，表项$M[A,a]$应放入产生式$A \rightarrow \beta$

    **对应LL(1)文法规则1**

  - 如果$\epsilon \in FIRST(\beta)$，且当前输入符号$a \in FOLLOW(A)$，表项$M[A,a]$应放入产生式$A \rightarrow \beta$

    **对应LL(1)文法规则2**



## 自底向上

**LR(k)**分析方法：

- L表示自左向右扫描字符串
- R表示为输入符号串构造一个最右推导的逆过程(关键在于找到当前句型的句柄)
- k表示需要向前看的输入符号的个数



基本思想是：

- 一方面要记住历史信息，即已经移进和归约出的整个符号串
- 另一方面要预测未来，即根据所用的推测未来可能遇到的输入符号



一个LR分析程序包括五部分：

- 输入缓冲区：存放待分析的输入符号串，以$\$$作为符号串的结束标志

- 输出：由LR分析控制程序分析输入符号串的过程中所采用的动作序列

- 栈：由状态栈和符号栈构成，两个栈同步增减

  - 状态栈存放形如$S_0S_1...S_m$的状态符号串，栈底的$S_0$是初始状态，栈顶的$S_m$是当前状态

    每个状态符号概括了在栈中位于它下面的部分所包含的全部信息，即从分析开始到某一归约阶段的全部历史信息和预测信息

  - 符号栈中存放形如$X_0X_1...X_m$的文法符号串，是从初态$S_0$到当前状态$S_m$的路径上各边的标记

    **有状态栈足够，一般忽略符号栈**

- 分析表：实际上是一个确定有限自动机的状态转移表。每一行对应一个状态，每一列对应一个文法符号或者$\$$。

  其中终结符号及$\$$对应的列构成**动作(action)表**，非终结符号对应的列构成**状态转移(goto)表**，即：

  - $goto[S_m，A]$保存了当前状态$S_m$相对于非终结符$A$的后继状态
  - $action[S_m, a_i]$规定了当前状态$S_m$面临输入符号$a_i$时应采取的分析动作，包括：
    - 移进：把当前输入符号$a_i$及S_
    - 归约：
    - 接收：分析成功，停止分析
    - 出错：调用出错处理程序，进行错误处理和恢复

  

- 分析控制程序

  **活前缀**



### LR(0)

### SLR(1)

### LR(1)

### LALR(1)

